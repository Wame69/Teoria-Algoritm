using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

class Program
{
    static List<string> allCities = new List<string>();
    static List<string> usedCities = new List<string>();
    static List<string> players = new List<string>();

    static void Main()
    {
        allCities = new List<string>(File.ReadAllLines("file.txt"));
        Console.WriteLine("Добро пожаловать в 'Города'!");
        Console.WriteLine("Чтобы завершить игру напишите 'сдаюсь'.");

        int playerCount = 2;

        for (int i = 1; i <= playerCount; i++)
        {
            players.Add($"Игрок {i}");
        }

        string previousCity = "";
        int currentPlayerIndex = 0;

        while (players.Count > 1)
        {
            string currentPlayer = players[currentPlayerIndex];
            Console.WriteLine($"\nХод {currentPlayer}");

            Console.Write("Введите город: ");
            string currentCity = Console.ReadLine().Trim();

            if (currentCity.ToLower() == "сдаюсь")
            {
                Console.WriteLine($"{currentPlayer} сдался.");
                players.RemoveAt(currentPlayerIndex);

                if (currentPlayerIndex >= players.Count)
                {
                    currentPlayerIndex = 0;
                }
            }
            else if (!IsCityInList(currentCity))
            {
                Console.WriteLine("Такого города не существует. Попробуйте снова.");
            }
            else if (usedCities.Contains(currentCity.ToLower()))
            {
                Console.WriteLine("Этот город уже был назван. Попробуйте другой.");
            }
            else if (!IsValidCity(previousCity, currentCity))
            {
                Console.WriteLine($"Город должен начинаться с буквы '{GetLastLetter(previousCity)}'. Попробуйте снова.");
            }
            else
            {
                usedCities.Add(currentCity.ToLower());
                previousCity = currentCity;

                if (AreCitiesExhaustedForLetter(GetLastLetter(previousCity)))
                {
                    Console.WriteLine($"Все города на букву '{GetLastLetter(previousCity)}' использованы. Игра завершена.");
                    break;
                }

                currentPlayerIndex = (currentPlayerIndex + 1) % players.Count;
            }
        }

        if (players.Count == 1)
        {
            Console.WriteLine($"\nПобедил {players[0]}! Игра завершена.");
        }
        else
        {
            Console.WriteLine("\nИгра завершена без победителя.");
        }
    }

    static bool IsCityInList(string city)
    {
        return allCities.Contains(city, StringComparer.OrdinalIgnoreCase);
    }

    static bool IsValidCity(string previousCity, string currentCity)
    {
        if (string.IsNullOrEmpty(previousCity)) return true;
        return currentCity[0] == GetLastLetter(previousCity);
    }

    static char GetLastLetter(string city)
    {
        city = city.ToLower();
        char lastChar = city[city.Length - 1];

        if (lastChar == 'ь' || lastChar == 'ы' || lastChar == 'ъ')
        {
            lastChar = city[city.Length - 2];
        }

        return lastChar;
    }
    static bool AreCitiesExhaustedForLetter(char letter)
    {
        var citiesStartingWithLetter = allCities
            .Where(city => city.StartsWith(letter.ToString(), StringComparison.OrdinalIgnoreCase))
            .Select(city => city.ToLower())
            .ToList();

        return citiesStartingWithLetter.All(city => usedCities.Contains(city));
    }
}
..........,.................... 
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

class Program
{
    static HashSet<string> usedCities = new HashSet<string>();
    static List<string> cities = new List<string>();

    static void Main()
    {
        LoadCitiesFromFile("cities.txt");

        Console.WriteLine("Выберите режим игры: \n1 - Два игрока \n2 - Игрок против компьютера");
        int mode = int.Parse(Console.ReadLine());

        if (mode == 1)
            TwoPlayerGame();
        else if (mode == 2)
            PlayerVsComputer();
        else
            Console.WriteLine("Неверный режим.");
    }

    static void LoadCitiesFromFile(string filePath)
    {
        if (File.Exists(filePath))
        {
            cities = File.ReadAllLines(filePath).ToList();
        }
        else
        {
            Console.WriteLine("Файл с городами не найден.");
            Environment.Exit(0);
        }
    }

    static void TwoPlayerGame()
    {
        string lastCity = "";
        int currentPlayer = 1;

        while (true)
        {
            Console.WriteLine($"Игрок {currentPlayer}, назовите город (или введите 'сдаться' для завершения):");
            string playerCity = Console.ReadLine().Trim();

            if (playerCity.ToLower() == "сдаться")
            {
                Console.WriteLine($"Игрок {3 - currentPlayer} победил!");
                break;
            }

            while (!IsValidCity(playerCity, lastCity, currentPlayer))
            {
                Console.WriteLine($"Игрок {currentPlayer}, попробуйте еще раз:");
                playerCity = Console.ReadLine().Trim();

                if (playerCity.ToLower() == "сдаться")
                {
                    Console.WriteLine($"Игрок {3 - currentPlayer} победил!");
                    return;
                }
            }

            usedCities.Add(playerCity.ToLower());
            lastCity = playerCity;

            // Проверка, остались ли города на последнюю букву
            if (!CitiesAvailable(lastCity))
            {
                Console.WriteLine($"Игрок {currentPlayer} проиграл! Все города на букву '{char.ToUpper(lastCity.Last())}' закончились.");
                break;
            }

            currentPlayer = 3 - currentPlayer; // Переключение между игроками
        }
    }

    static void PlayerVsComputer()
    {
        string lastCity = "";
        int currentPlayer = 1;

        while (true)
        {
            if (currentPlayer == 1) // Игрок
            {
                Console.WriteLine("Игрок, назовите город (или введите 'сдаться' для завершения):");
                string playerCity = Console.ReadLine().Trim();

                if (playerCity.ToLower() == "сдаться")
                {
                    Console.WriteLine("Компьютер победил!");
                    break;
                }

                while (!IsValidCity(playerCity, lastCity, currentPlayer))
                {
                    Console.WriteLine("Попробуйте еще раз:");
                    playerCity = Console.ReadLine().Trim();

                    if (playerCity.ToLower() == "сдаться")
                    {
                        Console.WriteLine("Компьютер победил!");
                        return;
                    }
                }

                usedCities.Add(playerCity.ToLower());
                lastCity = playerCity;

                // Проверка, остались ли города на последнюю букву
                if (!CitiesAvailable(lastCity))
                {
                    Console.WriteLine("Компьютер победил! Все города на букву '" + char.ToUpper(lastCity.Last()) + "' закончились.");
                    break;
                }
            }
            else // Компьютер
            {
                char nextLetter = GetNextLetter(lastCity);
                var availableCities = cities
                    .Where(city => !usedCities.Contains(city.ToLower()) && city.StartsWith(nextLetter.ToString(), StringComparison.OrdinalIgnoreCase))
                    .ToList();

                if (availableCities.Count > 0)
                {
                    string computerCity = availableCities[new Random().Next(availableCities.Count)];
                    Console.WriteLine($"Компьютер называет: {computerCity}");
                    usedCities.Add(computerCity.ToLower());
                    lastCity = computerCity;

                    // Проверка, остались ли города на последнюю букву
                    if (!CitiesAvailable(lastCity))
                    {
                        Console.WriteLine("Игрок победил! Все города на букву '" + char.ToUpper(lastCity.Last()) + "' закончились.");
                        break;
                    }
                }
                else
                {
                    Console.WriteLine("Игрок победил! Компьютер не может назвать город.");
                    break;
                }
            }
            currentPlayer = 3 - currentPlayer; // Переключение между игроком и компьютером
        }
    }

    static char GetNextLetter(string city)
    {
        if (string.IsNullOrEmpty(city)) return 'а';

        char lastChar = city[city.Length - 1];
        if (lastChar == 'ь' || lastChar == 'ъ')
            lastChar = city[city.Length - 2];

        return char.ToLower(lastChar);
    }

    static bool IsValidCity(string city, string lastCity, int currentPlayer)
    {
        if (usedCities.Contains(city.ToLower()))
        {
            Console.WriteLine($"Игрок {currentPlayer} проиграл! Город \"{city}\" уже был назван.");
            return false;
        }

        if (!cities.Contains(city, StringComparer.OrdinalIgnoreCase))
        {
            Console.WriteLine($"Игрок {currentPlayer} проиграл! Город \"{city}\" не существует.");
            return false;
        }

        if (!string.IsNullOrEmpty(lastCity))
        {
            char expectedFirstChar = GetNextLetter(lastCity);
            if (char.ToLower(city[0]) != expectedFirstChar)
            {
                Console.WriteLine($"Игрок {currentPlayer} проиграл! Город \"{city}\" не начинается на букву \"{expectedFirstChar}\".");
                return false;
            }
        }

        return true;
    }

    static bool CitiesAvailable(string lastCity)
    {
        if (string.IsNullOrEmpty(lastCity)) return false; // Проверка на пустую строку

        char lastChar = char.ToLower(lastCity.Last()); // Получаем последний символ в нижнем регистре

        // Проверяем, есть ли доступные города, которые начинаются на последний символ lastCity
        return cities.Any(city =>
            !usedCities.Contains(city.ToLower()) &&
            city.Length > 0 && // Убедимся, что город не пустой
            char.ToLower(city[0]) == lastChar);
    }

}
